import std:println
import std:io

source = || {
    return || {
        println("alpha")
        println("beta")
        println("gamma")
    }
}

sink = || {
    return || {
        loop through io:stdin::read_lines() with line {
            match {
                line ~ /beta/: return "beta received"
            }
        }
    }
}

out = source() | `grep beta` | sink()
println(out)  # beta received
