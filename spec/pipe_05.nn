import std:println
import std:io

source = || {
    return || {
        println("alpha")
        println("beta")
        println("gamma")
    }
}

sink = || {
    return || {
        loop through io:stdin::read_lines() with line {
            match {
                line ~ /BETA/: return "BETA ok"
            }
        }
    }
}

out = source() | `grep beta` | `sed 's/beta/BETA/'` | sink()
println(out)  # BETA ok
